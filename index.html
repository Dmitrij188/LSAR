<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Управление конфигурацией ЛсАР – интерактивное приложение</title>
  <link rel="stylesheet" href="assets/css/styles.css" />

</head>
<body>
  <header>
    <div class="header-row">
      <h1>Управление конфигурацией ЛсАР – интерактивное приложение</h1>
      <nav class="main-nav">
        <button class="nav-link" id="openHelp">Справка</button>
      </nav>
    </div>
  </header>
  <div class="container">
    <div class="images-block">
      <figure>
        <img src="lsar-stand.png" alt="Общий вид стенда ЛСАР" />
        <figcaption>Рис. 1 – Общий вид учебного стенда ЛСАР</figcaption>
      </figure>
      <figure>
        <img src="lsar-stand-labeled.png" alt="Аннотированный вид стенда ЛСАР" />
        <figcaption>Рис. 2 – Основные узлы стенда ЛСАР</figcaption>
      </figure>
    </div>

    <div class="tabs" id="mainTabs">
      <button class="tab-btn active" data-target="tab-ec">Элементы конфигурации (ЭК)</button>
      <button class="tab-btn" data-target="tab-cmdb">CMDB / Данные о конфигурации</button>
      <button class="tab-btn" data-target="tab-cr">Изменения (ЗИ / CR)</button>
      <button class="tab-btn" data-target="tab-audit">Аудиты</button>
      <button class="tab-btn" data-target="tab-baseline">Baseline и трассировка</button>
      <div class="tab-with-tooltip">
        <button class="tab-btn" data-target="tab-interactive-schemes">Интерактивные схемы</button>
        <div class="tab-tooltip">
          <div><strong>HW</strong> – электрическая схема стенда</div>
          <div><strong>SW</strong> – схема программного обеспечения</div>
          <div><strong>DOC</strong> – схема документации и связей</div>
        </div>
      </div>
    </div>

    <!-- Раздел ЭК -->
    <section id="tab-ec" class="card">
      <h2>Элементы конфигурации (ЭК)</h2>
      <p class="note">Реестр ЭК стенда ЛСАР хранится локально (эмуляция CMDB).</p>

      <div class="flex">
        <div class="grow">
          <label for="searchEc">Поиск по коду или наименованию</label>
          <input type="text" id="searchEc" placeholder="Например, LSAR-SW-03 или нагреватель" />
        </div>
      </div>

      <table id="ecTable">
        <thead>
          <tr>
            <th>Код ЭК</th>
            <th>Категория</th>
            <th>Наименование</th>
            <th>Описание</th>
            <th>Текущая версия / ревизия</th>
            <th>Статус</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3 style="margin-top:18px;">Добавление нового ЭК</h3>
      <form id="addEcForm" class="flex">
        <div class="grow">
          <label>Код ЭК *</label>
          <input type="text" id="ecCode" required />
        </div>
        <div class="grow">
          <label>Категория *</label>
          <select id="ecCategory" required>
            <option value="">Выберите</option>
            <option value="HW">HW</option>
            <option value="SW">SW</option>
            <option value="DOC">DOC</option>
          </select>
        </div>
        <div class="grow">
          <label>Наименование *</label>
          <input type="text" id="ecName" required />
        </div>
        <div class="grow">
          <label>Описание</label>
          <input type="text" id="ecDesc" />
        </div>
        <div class="grow">
          <label>Версия / ревизия</label>
          <input type="text" id="ecVersion" />
        </div>
        <div class="grow">
          <label>Статус *</label>
          <select id="ecStatus" required>
            <option value="">Выберите</option>
            <option>разрабатывается</option>
            <option>утверждено</option>
            <option>снято</option>
            <option>архив</option>
          </select>
        </div>
        <div style="align-self:flex-end;">
          <button type="submit" class="btn">Добавить ЭК</button>
        </div>
      </form>
    </section>

    <!-- Раздел CMDB -->
    <section id="tab-cmdb" class="card hidden">
      <h2>CMDB / Данные о конфигурации</h2>
      <p>CMDB стенда ЛСАР хранит единый реестр ЭК, карточки с версиями и серийными номерами, историю изменений, а также baseline-конфигурации, используемые для аудитов и трассировки.</p>
      <p>Данный прототип отражает структуру данных: список ЭК, карточки с атрибутами, ссылки на требования/тесты и наборы baseline.</p>

      <div class="tabs" id="cmdbTabs">
        <button class="tab-btn active" data-target="cmdb-registry">Реестр ЭК</button>
        <button class="tab-btn" data-target="cmdb-card">Карточка ЭК</button>
        <button class="tab-btn" data-target="cmdb-baseline">Базовые линии (Baseline)</button>
      </div>

      <div id="cmdb-registry" class="cmdb-block">
        <p class="note">Справочный реестр ЭК (read-only).</p>
        <table id="cmdbEcTable">
          <thead>
            <tr>
              <th>Код ЭК</th>
              <th>Категория</th>
              <th>Наименование</th>
              <th>Описание</th>
              <th>Версия</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="cmdb-card" class="cmdb-block hidden">
        <div class="flex">
          <div class="grow">
            <label for="cardSelect">Выберите ЭК</label>
            <select id="cardSelect"></select>
          </div>
        </div>
        <div id="cardDetails" class="card" style="margin-top:12px;">
          <p class="note">Выберите элемент конфигурации для отображения карточки.</p>
        </div>
      </div>

      <div id="cmdb-baseline" class="cmdb-block hidden">
        <div class="flex">
          <div class="grow">
            <label for="baselineSelect">Выберите baseline</label>
            <select id="baselineSelect"></select>
          </div>
        </div>
        <div id="baselineDetails" class="card" style="margin-top:12px;">
          <h3 id="baselineTitle">Baseline</h3>
          <table id="baselineTable">
            <thead>
              <tr>
                <th>Код ЭК</th>
                <th>Версия / Редакция</th>
                <th>Комментарий</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Раздел изменения -->
    <section id="tab-cr" class="card hidden">
      <h2>Изменения (ЗИ / CR)</h2>
      <p class="note">Упрощённый workflow запросов на изменение (Change Request).</p>
      <form id="crForm" class="flex">
        <div class="grow">
          <label>Номер ЗИ (генерируется)</label>
          <input type="text" id="crNumber" disabled />
        </div>
        <div class="grow">
          <label>Инициатор *</label>
          <input type="text" id="crAuthor" required />
        </div>
        <div class="grow">
          <label>Дата</label>
          <input type="date" id="crDate" />
        </div>
        <div class="grow">
          <label>Срочность</label>
          <select id="crUrgency">
            <option>низкая</option>
            <option selected>средняя</option>
            <option>высокая</option>
          </select>
        </div>
        <div class="grow">
          <label>Влияние на требования</label>
          <div class="inline"><input type="checkbox" id="crReqImpact" /> Да</div>
        </div>
        <div class="grow" style="min-width:260px;">
          <label>Затрагиваемые ЭК</label>
          <div id="crEcList"></div>
        </div>
        <div class="grow" style="flex-basis:100%;">
          <label>Описание предлагаемого изменения *</label>
          <textarea id="crDesc" required></textarea>
        </div>
        <div class="grow" style="flex-basis:100%;">
          <label>Обоснование / причина *</label>
          <textarea id="crReason" required></textarea>
        </div>
        <div style="align-self:flex-end;">
          <button type="submit" class="btn">Создать ЗИ</button>
        </div>
      </form>

      <table id="crTable" style="margin-top:18px;">
        <thead>
          <tr>
            <th>Номер ЗИ</th>
            <th>Дата</th>
            <th>Инициатор</th>
            <th>Описание</th>
            <th>Статус</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="crDetails" class="card" style="margin-top:12px;">
        <h3>Карточка ЗИ</h3>
        <p class="note">Выберите запись в таблице, чтобы просмотреть детали.</p>
        <div id="crDetailsContent"></div>
      </div>
    </section>

    <!-- Раздел аудитов -->
    <section id="tab-audit" class="card hidden">
      <h2>Аудиты</h2>
      <p class="note">Логика соответствует разделу «Аудит конфигурации» Плана УК.</p>
      <table id="auditTable">
        <thead>
          <tr>
            <th>Номер аудита</th>
            <th>Дата</th>
            <th>Тип</th>
            <th>Объект</th>
            <th>Статус</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="auditReport" class="card" style="margin-top:12px;">
        <h3>Отчёт по аудиту</h3>
        <p class="note">Выберите аудит для просмотра краткого отчёта.</p>
        <div id="auditDetails"></div>
      </div>
    </section>

    <!-- Раздел baseline и трассировки -->
    <section id="tab-baseline" class="card hidden">
      <h2>Baseline и трассировка</h2>
      <p>Матрица трассируемости требования → ЭК → испытания помогает анализировать воздействие изменений. Если меняется PID, видно связанные требования и ПМИ.</p>
      <table>
        <thead>
          <tr>
            <th>Требование</th>
            <th>Элементы конфигурации</th>
            <th>Тесты ПМИ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Стенд должен поддерживать температуру жидкости с точностью ±1°C.</td>
            <td>
              <div class="tag">LSAR-SW-03 (PID-регулятор)</div>
              <div class="tag">LSAR-HW-05 (датчики температуры)</div>
              <div class="tag">LSAR-HW-04 (радиатор с вентиляторами)</div>
              <div class="tag">LSAR-HW-03 (нагреватель)</div>
            </td>
            <td>ПМИ – Тест 3.1, 3.2, 3.3</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Раздел интерактивных схем -->
    <section id="tab-interactive-schemes" class="card hidden">
      <h2>Интерактивные схемы</h2>
      <p class="note">Визуализация электрической, программной и документационной схем ЛСАР с привязкой к ЭК, ЗИ и аудитам.</p>
      <div class="scheme-submenu" id="schemeSubmenu">
        <button class="tab-btn active" data-scheme-target="HW">HW-схема</button>
        <button class="tab-btn" data-scheme-target="SW">SW-схема</button>
        <button class="tab-btn" data-scheme-target="DOC">DOC-схема</button>
      </div>
      <p class="scheme-note">Схемы доступны только для просмотра: выберите узел, чтобы увидеть связанные ЭК, ЗИ и аудиты.</p>
      <div class="scheme-actions">
        <button class="btn" onclick="window.location.href='docs/lsar-doc-04/power.html'">Схемы питания ЛСАР</button>
        <div class="scheme-note">Блок-схемы, требования и варианты реализации системы питания.</div>
      </div>
      <div class="scheme-layout">
        <div class="scheme-area">
          <div id="scheme-hw" class="scheme-view">
            <div id="scheme-container">
              <img id="lsar-scheme" src="lsar-scheme.png" alt="Схема ЛСАР" />
              <!-- Маркеры узлов будут добавлены скриптом -->
            </div>
          </div>
          <div id="scheme-sw" class="scheme-view hidden">
            <div id="scheme-sw-diagram" class="diagram-grid sw-grid">
              <div class="diagram-node" data-node-id="SW_MAIN">main() / инициализация</div>
              <div class="diagram-node" data-node-id="SW_TASKS">Задачи FreeRTOS</div>
              <div class="diagram-node" data-node-id="SW_PUMP">Task_PumpCtrl</div>
              <div class="diagram-node" data-node-id="SW_FANS">Task_FansCtrl</div>
              <div class="diagram-node" data-node-id="SW_TEMP">Task_TempControl</div>
              <div class="diagram-node" data-node-id="SW_LOG">Task_Logging</div>
              <div class="diagram-node" data-node-id="SW_PID">PID-регулятор (LSAR-SW-03)</div>
              <div class="diagram-node" data-node-id="SW_DRIVERS">Драйверы датчиков</div>
              <div class="diagram-node" data-node-id="SW_CONFIG">Конфигурация и калибровки</div>
              <div class="diagram-node" data-node-id="SW_DIAG">Интерфейс диагностики</div>
            </div>
          </div>
          <div id="scheme-doc" class="scheme-view hidden">
            <div id="scheme-doc-diagram" class="diagram-grid doc-grid">
              <div class="diagram-node" data-node-id="DOC_REQ">Требования (LSAR-REQ)</div>
              <div class="diagram-node" data-node-id="DOC_FTT">LSAR-DOC-01 ФТТ</div>
              <div class="diagram-node" data-node-id="DOC_PMI">LSAR-DOC-02 ПМИ</div>
              <div class="diagram-node" data-node-id="DOC_PASSPORT">LSAR-DOC-03 Паспорт изделия</div>
              <div class="diagram-node" data-node-id="DOC_ELEC">LSAR-DOC-04 Электрическая схема</div>
              <div class="diagram-node" data-node-id="DOC_HYDRO">LSAR-DOC-05 Гидравлическая схема</div>
              <div class="diagram-node" data-node-id="DOC_JOURNAL">LSAR-DOC-07 Журнал изменений</div>
              <div class="diagram-node" data-node-id="DOC_BASE10">Baseline 1.0</div>
              <div class="diagram-node" data-node-id="DOC_BASE11">Baseline 1.1</div>
            </div>
          </div>
        </div>
        <aside class="scheme-info" id="scheme-info-panel">
          <h3 id="schemeInfoTitle">Выберите элемент на схеме</h3>
          <p id="schemeInfoDesc" class="scheme-note">Наведите на элемент схемы для краткой подсказки или кликните, чтобы открыть карточку узла.</p>
          <div id="schemeInfoContent"></div>
        </aside>
      </div>
    </section>
  </div>

  <script src="assets/js/app.js"></script>

</body>
</html>
